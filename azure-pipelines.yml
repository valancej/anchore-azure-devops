trigger:
- master

jobs:
- job: Build
  pool:
    vmImage: 'Ubuntu-16.04'
  steps:
  - script: | 
      docker login -u $(dockerhubUser) -p $(dockerhubPass)
      docker build -t jvalance/node_critical_fail .
      docker push jvalance/node_critical_fail
    displayName: 'Build and push Docker image'
- job: Scan
  pool:
    vmImage: 'Ubuntu-16.04'
  container: anchore/engine-cli:latest
  dependsOn: Build
  steps:
  - script: |
      echo "Adding image to Anchore engine"
      anchore-cli image add
  displayName: 'Scan image with Anchore'
